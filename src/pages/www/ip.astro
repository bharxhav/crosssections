---
import WwwLayout from "../../layouts/WwwLayout.astro";
---

<WwwLayout title="IP" subtitle="Internet Protocol â€” the network layer" slug="ip">
  <!-- IPv4 Header Structure -->
  <section class="section">
    <h2>IPv4 Header <span class="spec-label">RFC 791</span></h2>

    <div class="diagram">
      <svg viewBox="0 0 520 220" xmlns="http://www.w3.org/2000/svg">
        <!-- Bit scale -->
        <text x="32" y="12" text-anchor="middle" class="label">0</text>
        <text x="80" y="12" text-anchor="middle" class="label">4</text>
        <text x="128" y="12" text-anchor="middle" class="label">8</text>
        <text x="192" y="12" text-anchor="middle" class="label">16</text>
        <text x="304" y="12" text-anchor="middle" class="label">24</text>
        <text x="448" y="12" text-anchor="middle" class="label">31</text>

        <!-- Word 0: Version, IHL, TOS, Total Length -->
        <rect x="10" y="20" width="48" height="30" class="filled" stroke-width="1"/>
        <text x="34" y="40" text-anchor="middle">Ver</text>
        <text x="34" y="55" text-anchor="middle" class="label">4 bits</text>

        <rect x="58" y="20" width="48" height="30" class="filled" stroke-width="1"/>
        <text x="82" y="40" text-anchor="middle">IHL</text>
        <text x="82" y="55" text-anchor="middle" class="label">4 bits</text>

        <rect x="106" y="20" width="96" height="30" class="filled" stroke-width="1"/>
        <text x="154" y="40" text-anchor="middle">TOS</text>
        <text x="154" y="55" text-anchor="middle" class="label">8 bits</text>

        <rect x="202" y="20" width="192" height="30" class="filled" stroke-width="1"/>
        <text x="298" y="40" text-anchor="middle">Total Length</text>
        <text x="298" y="55" text-anchor="middle" class="label">16 bits</text>

        <!-- Word 1: ID, Flags, Fragment Offset -->
        <rect x="10" y="60" width="192" height="30" class="filled" stroke-width="1"/>
        <text x="106" y="80" text-anchor="middle">Identification</text>
        <text x="106" y="95" text-anchor="middle" class="label">16 bits</text>

        <rect x="202" y="60" width="36" height="30" class="filled" stroke-width="1"/>
        <text x="220" y="80" text-anchor="middle">Flg</text>
        <text x="220" y="95" text-anchor="middle" class="label">3</text>

        <rect x="238" y="60" width="156" height="30" class="filled" stroke-width="1"/>
        <text x="316" y="80" text-anchor="middle">Fragment Offset</text>
        <text x="316" y="95" text-anchor="middle" class="label">13 bits</text>

        <!-- Word 2: TTL, Protocol, Checksum -->
        <rect x="10" y="100" width="96" height="30" class="filled" stroke-width="1"/>
        <text x="58" y="120" text-anchor="middle">TTL</text>
        <text x="58" y="135" text-anchor="middle" class="label">8 bits</text>

        <rect x="106" y="100" width="96" height="30" class="filled" stroke-width="1"/>
        <text x="154" y="120" text-anchor="middle">Protocol</text>
        <text x="154" y="135" text-anchor="middle" class="label">8 bits</text>

        <rect x="202" y="100" width="192" height="30" class="filled" stroke-width="1"/>
        <text x="298" y="120" text-anchor="middle">Header Checksum</text>
        <text x="298" y="135" text-anchor="middle" class="label">16 bits</text>

        <!-- Word 3: Source IP -->
        <rect x="10" y="140" width="384" height="30" class="filled" stroke-width="1"/>
        <text x="202" y="160" text-anchor="middle">Source IP Address</text>
        <text x="202" y="175" text-anchor="middle" class="label">32 bits</text>

        <!-- Word 4: Destination IP -->
        <rect x="10" y="180" width="384" height="30" class="filled" stroke-width="1"/>
        <text x="202" y="200" text-anchor="middle">Destination IP Address</text>
        <text x="202" y="215" text-anchor="middle" class="label">32 bits</text>

        <!-- Byte markers on right -->
        <text x="410" y="40" class="label">0-3</text>
        <text x="410" y="80" class="label">4-7</text>
        <text x="410" y="120" class="label">8-11</text>
        <text x="410" y="160" class="label">12-15</text>
        <text x="410" y="200" class="label">16-19</text>
        <text x="460" y="120" text-anchor="middle" class="label">bytes</text>
      </svg>
    </div>

    <table class="defaults-table">
      <tr><th>Field</th><th>Size</th><th>Description</th></tr>
      <tr><td><code>Version</code></td><td>4 bits</td><td>Always 4 for IPv4</td></tr>
      <tr><td><code>IHL</code></td><td>4 bits</td><td>Header length in 32-bit words (min: 5)</td></tr>
      <tr><td><code>TOS</code></td><td>8 bits</td><td>Type of Service / DSCP + ECN</td></tr>
      <tr><td><code>Total Length</code></td><td>16 bits</td><td>Entire packet size in bytes (max: 65535)</td></tr>
      <tr><td><code>TTL</code></td><td>8 bits</td><td>Hop limit, decremented by each router</td></tr>
      <tr><td><code>Protocol</code></td><td>8 bits</td><td>Encapsulated protocol number</td></tr>
    </table>
  </section>

  <!-- Protocol Numbers -->
  <section class="section">
    <h2>Protocol Numbers <span class="spec-label">IANA Assigned</span></h2>

    <table class="defaults-table">
      <tr><th>Number</th><th>Protocol</th><th>Description</th></tr>
      <tr><td><code>1</code></td><td>ICMP</td><td>Internet Control Message Protocol</td></tr>
      <tr><td><code>2</code></td><td>IGMP</td><td>Internet Group Management Protocol</td></tr>
      <tr><td><code>6</code></td><td>TCP</td><td>Transmission Control Protocol</td></tr>
      <tr><td><code>17</code></td><td>UDP</td><td>User Datagram Protocol</td></tr>
      <tr><td><code>41</code></td><td>IPv6</td><td>IPv6 encapsulation</td></tr>
      <tr><td><code>47</code></td><td>GRE</td><td>Generic Routing Encapsulation</td></tr>
      <tr><td><code>50</code></td><td>ESP</td><td>Encapsulating Security Payload</td></tr>
      <tr><td><code>89</code></td><td>OSPF</td><td>Open Shortest Path First</td></tr>
    </table>
  </section>

  <!-- TTL Defaults -->
  <section class="section">
    <h2>TTL Defaults <span class="spec-label">Time To Live</span></h2>

    <table class="defaults-table">
      <tr><th>Operating System</th><th>Default TTL</th></tr>
      <tr><td>Linux</td><td><code>64</code></td></tr>
      <tr><td>macOS</td><td><code>64</code></td></tr>
      <tr><td>Windows</td><td><code>128</code></td></tr>
      <tr><td>Cisco IOS (routers)</td><td><code>255</code></td></tr>
      <tr><td>Solaris</td><td><code>255</code></td></tr>
    </table>

    <pre class="bytes"># Received TTL can fingerprint sender OS
# 64 - (64 - received) = hops traversed
# Example: TTL=52 means 12 hops from Linux host</pre>
  </section>

  <!-- IP Address Classes -->
  <section class="section">
    <h2>Address Classes <span class="spec-label">Classful (Historical)</span></h2>

    <div class="diagram">
      <svg viewBox="0 0 400 150" xmlns="http://www.w3.org/2000/svg">
        <!-- Class A -->
        <rect x="10" y="10" width="25" height="22" class="filled" stroke-width="1"/>
        <text x="22" y="25" text-anchor="middle">0</text>
        <rect x="35" y="10" width="75" height="22" class="filled" stroke-width="1"/>
        <text x="72" y="25" text-anchor="middle">Network</text>
        <rect x="110" y="10" width="200" height="22" class="filled" stroke-width="1"/>
        <text x="210" y="25" text-anchor="middle">Host</text>
        <text x="330" y="25">Class A</text>

        <!-- Class B -->
        <rect x="10" y="40" width="25" height="22" class="filled" stroke-width="1"/>
        <text x="22" y="55" text-anchor="middle">10</text>
        <rect x="35" y="40" width="115" height="22" class="filled" stroke-width="1"/>
        <text x="92" y="55" text-anchor="middle">Network</text>
        <rect x="150" y="40" width="160" height="22" class="filled" stroke-width="1"/>
        <text x="230" y="55" text-anchor="middle">Host</text>
        <text x="330" y="55">Class B</text>

        <!-- Class C -->
        <rect x="10" y="70" width="25" height="22" class="filled" stroke-width="1"/>
        <text x="22" y="85" text-anchor="middle">110</text>
        <rect x="35" y="70" width="175" height="22" class="filled" stroke-width="1"/>
        <text x="122" y="85" text-anchor="middle">Network</text>
        <rect x="210" y="70" width="100" height="22" class="filled" stroke-width="1"/>
        <text x="260" y="85" text-anchor="middle">Host</text>
        <text x="330" y="85">Class C</text>

        <!-- Bit scale -->
        <text x="10" y="115" class="label">0</text>
        <text x="110" y="115" class="label">8</text>
        <text x="150" y="115" class="label">16</text>
        <text x="210" y="115" class="label">24</text>
        <text x="310" y="115" class="label">32</text>
        <line x1="10" y1="105" x2="310" y2="105" stroke-width="1" opacity="0.3"/>
      </svg>
    </div>

    <table class="defaults-table">
      <tr><th>Class</th><th>First Octet</th><th>Default Mask</th><th>Networks</th></tr>
      <tr><td>A</td><td><code>1-126</code></td><td><code>/8</code> (255.0.0.0)</td><td>128</td></tr>
      <tr><td>B</td><td><code>128-191</code></td><td><code>/16</code> (255.255.0.0)</td><td>16,384</td></tr>
      <tr><td>C</td><td><code>192-223</code></td><td><code>/24</code> (255.255.255.0)</td><td>2,097,152</td></tr>
      <tr><td>D</td><td><code>224-239</code></td><td>Multicast</td><td>N/A</td></tr>
      <tr><td>E</td><td><code>240-255</code></td><td>Reserved</td><td>N/A</td></tr>
    </table>
  </section>

  <!-- CIDR Notation -->
  <section class="section">
    <h2>CIDR Notation <span class="spec-label">RFC 4632</span></h2>

    <div class="diagram">
      <svg viewBox="0 0 400 60" xmlns="http://www.w3.org/2000/svg">
        <rect x="10" y="15" width="180" height="30" class="filled" stroke-width="1"/>
        <text x="100" y="35" text-anchor="middle">192.168.1.0</text>
        <text x="100" y="55" text-anchor="middle" class="label">network address</text>

        <text x="200" y="35" fill="currentColor">/</text>

        <rect x="210" y="15" width="50" height="30" class="filled" stroke-width="1"/>
        <text x="235" y="35" text-anchor="middle">24</text>
        <text x="235" y="55" text-anchor="middle" class="label">prefix</text>

        <text x="280" y="35" opacity="0.5">= 256 hosts</text>
      </svg>
    </div>

    <table class="defaults-table">
      <tr><th>CIDR</th><th>Subnet Mask</th><th>Hosts</th><th>Common Use</th></tr>
      <tr><td><code>/32</code></td><td>255.255.255.255</td><td>1</td><td>Single host</td></tr>
      <tr><td><code>/30</code></td><td>255.255.255.252</td><td>2</td><td>Point-to-point link</td></tr>
      <tr><td><code>/24</code></td><td>255.255.255.0</td><td>254</td><td>Small network</td></tr>
      <tr><td><code>/16</code></td><td>255.255.0.0</td><td>65,534</td><td>Medium network</td></tr>
      <tr><td><code>/8</code></td><td>255.0.0.0</td><td>16,777,214</td><td>Large network</td></tr>
      <tr><td><code>/0</code></td><td>0.0.0.0</td><td>All</td><td>Default route</td></tr>
    </table>
  </section>

  <!-- Special Addresses -->
  <section class="section">
    <h2>Special Addresses <span class="spec-label">RFC 5735</span></h2>

    <table class="defaults-table">
      <tr><th>Address</th><th>Range</th><th>Purpose</th></tr>
      <tr><td><code>0.0.0.0</code></td><td>0.0.0.0/8</td><td>"This" network, default route</td></tr>
      <tr><td><code>127.0.0.1</code></td><td>127.0.0.0/8</td><td>Loopback (localhost)</td></tr>
      <tr><td><code>255.255.255.255</code></td><td>-</td><td>Limited broadcast</td></tr>
      <tr><td><code>10.0.0.0</code></td><td>10.0.0.0/8</td><td>Private (Class A)</td></tr>
      <tr><td><code>172.16.0.0</code></td><td>172.16.0.0/12</td><td>Private (Class B)</td></tr>
      <tr><td><code>192.168.0.0</code></td><td>192.168.0.0/16</td><td>Private (Class C)</td></tr>
      <tr><td><code>169.254.0.0</code></td><td>169.254.0.0/16</td><td>Link-local (APIPA)</td></tr>
      <tr><td><code>224.0.0.0</code></td><td>224.0.0.0/4</td><td>Multicast</td></tr>
    </table>
  </section>

  <!-- Fragmentation Flags -->
  <section class="section">
    <h2>Fragmentation <span class="spec-label">Flags Field</span></h2>

    <div class="diagram">
      <svg viewBox="0 0 320 50" xmlns="http://www.w3.org/2000/svg">
        <rect x="10" y="10" width="60" height="25" class="filled" stroke-width="1"/>
        <text x="40" y="27" text-anchor="middle">0</text>
        <text x="40" y="45" text-anchor="middle" class="label">reserved</text>

        <rect x="75" y="10" width="60" height="25" class="filled" stroke-width="1"/>
        <text x="105" y="27" text-anchor="middle">DF</text>
        <text x="105" y="45" text-anchor="middle" class="label">don't frag</text>

        <rect x="140" y="10" width="60" height="25" class="filled" stroke-width="1"/>
        <text x="170" y="27" text-anchor="middle">MF</text>
        <text x="170" y="45" text-anchor="middle" class="label">more frags</text>

        <text x="220" y="27" class="label">3 bits total</text>
      </svg>
    </div>

    <table class="defaults-table">
      <tr><th>Flag</th><th>Value</th><th>Meaning</th></tr>
      <tr><td><code>DF</code></td><td>0</td><td>May fragment</td></tr>
      <tr><td><code>DF</code></td><td>1</td><td>Don't fragment (drop if too large)</td></tr>
      <tr><td><code>MF</code></td><td>0</td><td>Last fragment</td></tr>
      <tr><td><code>MF</code></td><td>1</td><td>More fragments follow</td></tr>
    </table>

    <pre class="bytes"># Default MTU (Maximum Transmission Unit)
Ethernet: 1500 bytes
PPPoE:    1492 bytes
VPN:      ~1400 bytes (varies by overhead)</pre>
  </section>
</WwwLayout>
